# Copyright 2023 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
#     Unless required by applicable law or agreed to in writing, software
#     distributed under the License is distributed on an "AS IS" BASIS,
#     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#     See the License for the specific language governing permissions and
#     limitations under the License.

âŸ¨TestSuiteâŸ© â† â€¢Import "../test.bqn"

ts â† TestSuite "Under"


# Similar to mathematics, in BQN some functions can be inverted. â¼ (Undo) is a
# 1-combinator which inverts a verb. That is ğ•©' = ğ”½ ğ•© is equivalent to ğ•© = ğ”½â¼ ğ•©'.
# Likewise, ğ•©' = ğ•¨ ğ”½ ğ•© is equivalent to ğ•© = ğ•¨ ğ”½â¼ ğ•©'

{ ğ•¤ â‹„
  âˆâ€¿8 â‰¡ 5 (+â¼ â‹ˆ +) 3
} ts._Test "Undoing addition"

{ ğ•¤ â‹„
  âˆâ€¿16 â‰¡ 2 (â‹†â¼ â‹ˆ â‹†) 4
} ts._Test "Undoing power"

{ ğ•¤ â‹„
  nums â† 3â€¿2â€¿Â¯3
  âˆ â‰¡ -â¼ - nums
} ts._Test "Invertible"


# Some functions, like â‹†, do not have a unique inverse.  For example,
# 2 â‹† 2 = Â¯2 â‹† 2.  Should 2 â‹†Ëœâ¼ 4 evaluate to 2 or Â¯2?  BQN will pick
# one of the values.  In this case, the positive value.  This will only
# work for relatively simple cases.  â¼ can't guess, for example, how to
# reshape an array, or other structural changes.

{ ğ•¤ â‹„
  âˆ = 2 â‹†Ëœâ¼ 4
} ts._Test "Non-unique power inverse"

{ ğ•¤ â‹„
  âˆ = Ã—Ëœâ¼ 9
} ts._Test "Square inverse"


# âŒ¾ (Under) is a 2-combinator similar to â¼.  ğ”½ âŒ¾ ğ”¾ is equivalent to
# ğ”¾â¼ âˆ˜ ğ”½ â—‹ ğ”¾.
#
#     ğ”½âŒ¾ğ”¾ ğ•©    ğ•¨ ğ”½âŒ¾ğ”¾ ğ•©
#
#      ğ”¾â¼         ğ”¾â¼
#      â”‚          â”‚
#      ğ”½          ğ”½
#      â”‚         â•± â•²
#      ğ”¾        ğ”¾   ğ”¾
#      â”‚        â”‚   â”‚
#      ğ•©        ğ•¨   ğ•©

{ ğ•¤ â‹„
  âˆ = 3 +âŒ¾(Ã—Ëœ) 4
} ts._Test "Sum under square"

{ ğ•¤ â‹„
  Â¯81 = (Ã—Ëœ âŒ¾ Ã—) Â¯9
} ts._Test "Negative square"

{ ğ•¤ â‹„
  1 = Â¯1 (Ã—Ëœ)â—‹âŠ¢ Â¯2
} ts._Test "Devolving to monadic"


# We said that â¼ could not invert certain structural functions like reshaping,
# dropping or taking elements from an array. âŒ¾, on the other hand, can do so
# because it knows the original elements of the array. This is called
# "Structural Under".
#
# Take âŠ‘ as an example, which gets the first element of the array. If we would
# like to change the first element of the array to, say, 9, we could do
# something like 9âŒ¾âŠ‘. In this verb, the first element will be got from the
# array, the function 9 will be applied to it (which will always return 9),
# and then the transformed value will be placed back into the array at the
# same location.

{ ğ•¤ â‹„
  âˆ â‰¡ 9âŒ¾âŠ‘ 3â€¿1â€¿1
} ts._Test "Replacing the first element"

{
  âˆ â‰¡ (0â€¿0)âŒ¾âŠ 2â€¿2 â¥Š 1
} ts._Test "Replacing the first cell"


ts.Report @
