# Copyright 2023 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
#     Unless required by applicable law or agreed to in writing, software
#     distributed under the License is distributed on an "AS IS" BASIS,
#     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#     See the License for the specific language governing permissions and
#     limitations under the License.

âŸ¨TestSuiteâŸ© â† â€¢Import "../test.bqn"

ts â† TestSuite "Reverse, Rotate, Transpose"

# We've several means of working with and transforming arrays so far: how to
# take elements from an array with âŠ, how to construct a new array using
# structural âŒ¾, how to reshape an array with â¥Š (even leaving one dimension
# empty with âˆ˜ and filling extra spaces with â†‘), how to reduce elements of an
# array using Â´ and reduce cells using Ë, how to map a function to elements of
# an array using Â¨ or to cells using Ë˜. There are yet other means of
# transforming arrays.
#
# âŒ½ (Reverse) is a monadic verb which reverses a list.

{ ğ•¤ â‹„
  âˆ â‰¡ âŒ½ "esreveR"
} ts._Test "Reverse a list"

{ ğ•¤ â‹„
   âŸ¨âŸ©â€¿âŸ¨1âŸ© â‰¡ âŒ½ âŸ¨âŸ©â€¿âŸ¨1âŸ©
} ts._Test "Reverse identity"

{ ğ•¤ â‹„
  âˆ â‰¡ âŒ½â¼ 1â€¿3â€¿5â€¿2
} ts._Test "Reverse inverse"

{ ğ•¤ â‹„
  (2â€¿âˆ˜ â¥Š 1â€¿2â€¿3â€¿4) â‰¡ âŒ½ (2â€¿âˆ˜ â¥Š 2â€¿1â€¿4â€¿3)
} ts._Test "Reverse cells"


# âŒ½ (Rotate) is the dyadic version of âŒ½.  It rotates a list cycically to the left.
# That is, n âŒ½ x1â€¿x2â€¿...â€¿xk for some n < k will result in a list x(n+1)â€¿x(n+2)â€¿...â€¿x(n).

{ ğ•¤ â‹„
  âˆ â‰¡ 1 âŒ½ 1â€¿2â€¿3
} ts._Test "Move first element to end"

{ ğ•¤ â‹„
  âˆ â‰¡ 2 âŒ½ "recent"
} ts._Test "rotational anagram"


# An array has multiple axes, and âŒ½ can operate on each of those axes independently.
# So, for example, if we have a rank 2 array, a â† 2â€¿2 â¥Š 0â€¿1â€¿2â€¿3,
#
#    â”Œâ”€
#    â•µ 0 1
#      2 3
#          â”˜
#
# We can rotate across different axes by passing a list as the left argument of âŒ½.
# The first element in the list rotates around the leading axis.  That is, it rotates
# the major cells of the array.  In that way, 1â€¿0 âŒ½ a is equivalent to 1 âŒ½ a.
# The second element in a list rotates the next axis. That is, it rotates the major
# cells of each of the major cells, so that 0â€¿1 âŒ½ a is equivalent to 1 âŒ½Ë˜ a, and so on.
#
#   1â€¿0 âŒ½ a      0â€¿1 âŒ½ a
#
#   â”Œâ”€           â”Œâ”€
#   â•µ 2 3        â•µ 1 0
#     0 1          3 2
#         â”˜            â”˜
#
# Passing a list as the left argument allows us to rotate across different axes at the
# same time without having to use Ë˜.  Rather than 1 âŒ½Ë˜Ë˜Ë˜ 2 âŒ½Ë˜Ë˜ 3 âŒ½Ë˜ 4 âŒ½ a, we can write
# 4â€¿3â€¿2â€¿1 âŒ½ a.
#
#   1â€¿1 âŒ½ a      1â€¿2 âŒ½ a
#
#   â”Œâ”€           â”Œâ”€
#   â•µ 3 2        â•µ 2 3
#     1 0          0 1
#         â”˜            â”˜

{ ğ•¤ â‹„
  a â† 8â€¿3â€¿4 â¥Š 0â€¿1â€¿2â€¿3â€¿4â€¿4
  (1 âŒ½ a) â‰¡ 5 âŒ½Ë˜Ë˜ 2 âŒ½Ë˜ 3 âŒ½ a
} ts._Test "Equivalence with cells"

{ ğ•¤ â‹„
  a â† 3â€¿3 â¥Š 1â€¿2â€¿3â€¿4â€¿5â€¿6â€¿7â€¿8â€¿9
  âˆ â‰¡ +Ë (1â€¿1 âŒ½ 3â€¿3 â¥Š 1â€¿0) Ã— a
} ts._Test "Reshaping masks"


# â‰ (Transpose) is another common array operation.  For a two-dimensional array
# whose elements are defined by a[i, j], where i is the row and j is the cell,
# â‰ exchanges the i and j indices. (Visually, it flips the array along the diagonal
# from the top left to the bottom right.)

{ ğ•¤ â‹„
  âˆ â‰¡ â‰ 2â€¿2 â¥Š 0â€¿1â€¿2â€¿3
} ts._Test "Transpose"

{ ğ•¤ â‹„
  âˆ â‰¡ â‰ 2â€¿3 â¥Š 1â€¿2â€¿3â€¿4â€¿5â€¿6
} ts._Test "Transpose non-square array"


# An easy way to build arrays is the monadic verb, â†• (Range).  Given a number, n,
# â†• will return a list 0â€¿1â€¿...â€¿(n - 1).

{ ğ•¤ â‹„
  0â€¿1â€¿2â€¿3 â‰¡ â†• 3
} ts._Test "Simple range"

{ ğ•¤ â‹„
  RangeEqual â† â‰ âˆ˜â†• = Ã—
  Ã—Â´ RangeEqualÂ¨ 1â€¿2â€¿3â€¿4â€¿5
} ts._Test "Length of range equals initial value"

{ ğ•¤ â‹„
  # Make an ğ•© by ğ•© holding the values from 0 to ğ•©Ã—ğ•©.
  MakeArray â† â‹ˆËœ â¥Š â†•âˆ˜Ã—Ëœ

  (3â€¿3 â¥Š 1â€¿0â€¿0â€¿0â€¿1â€¿0â€¿0â€¿0â€¿1) â‰¡ (âŠ¢ =Â¨ âŠ¢) MakeArray 3
} ts._Test "Building identity"

{ ğ•¤ â‹„
  âˆ â‰¡ â‰Ë˜ 1â€¿2â€¿3 â¥Š â†• 6
} ts._Test "Transposing cells"


# In order to transpose an array, â‰ moves the first axis to the end.
# (This results in a typical transpose for rank-2 arrays.)

{ ğ•¤ â‹„
  âˆ â‰¡ â‰¢ â‰ 1â€¿2â€¿3 â¥Š â†• 6
} ts._Test "Transpose's effect on shape"

{ ğ•¤ â‹„
  âˆ â‰¡ â‰¢ â‰â¼ â‰ 1â€¿2â€¿3 â¥Š â†• 6
} ts._Test "Undoing the transpose"

{ ğ•¤ â‹„
  âˆ â‰¡ â‰¢ â‰â¼ 1â€¿2â€¿3 â¥Š â†• 6
} ts._Test "Transposing backwards"


# The dyadic verb, â‰ (Reorder), reorders the axes by the left argument. The
# left argument describes where the axes of the array on the right will move.
# That is, a0â€¿a1â€¿...an â‰ ğ•© means that the first axis in ğ•© will go to a0, the
# second axis will go to a1, ..., and the last axis will go to an.

{ ğ•¤ â‹„
  âˆ â‰¡ â‰¢ 2â€¿0â€¿1 â‰ 1â€¿2â€¿3 â¥Š â†• 6
} ts._Test "Reordering axes"

{ ğ•¤ â‹„
  âˆ â‰¡ â‰¢ 2â€¿1â€¿0 â‰ 1â€¿2â€¿3 â¥Š â†• 6
} ts._Test "Reversing axes"

{ ğ•¤ â‹„
  2â€¿1â€¿3 â‰¡ â‰¢ 0â€¿0â€¿0 â‰ 1â€¿2â€¿3 â¥Š â†• 6
} ts._Test "Another rearranging"


ts.Report @
